

If you work with container :
docker run -p 9090:9090 -d --name prometheus prom/prometheus
docker exec -it prometheus sh

docker run -dit --name ubuntu_node ubuntu
docker exec -it ubuntu_node bash
apt-get update
apt-get install -y wget tar
apt-get update
apt-get install -y vim nano


Create a node_exporter user to run the node exporter service:
sudo useradd --no-create-home --shell /bin/false node_exporter


download Node_Exporter instalation directory:
cd /tmp/
wget https://github.com/prometheus/node_exporter/releases/download/v1.10.2/node_exporter-1.10.2.linux-amd64.tar.gz


extraxt files:
tar -xvf node_exporter-1.10.2.linux-amd64.tar.gz
cd node_exporter-1.3.1.linux-amd64
ls

Move the node export binary to /usr/local/bin and give it permission:
sudo mv node_exporter /usr/local/bin/
sudo chown node_exporter:node_exporter /usr/local/bin/node_exporter

Create a node_exporter service file under systemd:
sudo vim /etc/systemd/system/node_exporter.service

---
[Unit]
Description=Node Exporter
After=network.target

[Service]
User=node_exporter
Group=node_exporter
Type=simple
ExecStart=/usr/local/bin/node_exporter

[Install]
WantedBy=multi-user.target
---

# For Conatiner :
docker run -dit --name ubuntu_node -p 9100:9100 ubuntu
docker run -d --name=node_exporter -p 9100:9100 prom/node-exporter


# This makes them talk to each other by container name instead of localhost.
# docker network create monitoring
# docker network connect monitoring promet
# docker network connect monitoring node_exporter



Reload the system daemon, start and enable Node_Exporter service:
sudo systemctl daemon-reload
sudo systemctl start node_exporter
sudo systemctl enable node_exporter

check the node exporter status:
sudo systemctl status node_exporter



$ sudo vim /etc/prometheus/prometheus.yml

# Under the scrape config section add the node exporter target as shown below.:
- job_name: 'node_exporter_metrics'
  scrape_interval: 5s
  static_configs:
    - targets: ['10.142.0.3:9100']


For Container :

# scrape_configs:
#   - job_name: 'node'
#     static_configs:
#       - targets: ['host.docker.internal:9100']

#OR
# scrape_configs:
#   - job_name: 'node'
#     static_configs:
#       - targets: ['node_exporter:9100']

# if you dont create  new network : use ip --> - targets: ["172.17.0.3:9100"]


$ sudo systemctl restart prometheus

#for container : 
docker restart promet







## Troubelshot 
docker network inspect bridge
docker network create monitoring
docker network connect monitoring prometheus
docker network connect monitoring node_exporter


# ✅ Why create a custom network (like monitoring)
# 1. Name-based resolution
# On the default bridge network, containers cannot resolve each other by name (e.g., node_exporter:9100) unless you manually link them or use legacy options.
# That’s because the default bridge doesn’t have an embedded DNS service — it only provides basic NAT and IP routing.

# So when Prometheus tries to reach node_exporter:9100 on the default bridge, it fails, because there’s no DNS resolution for node_exporter. You had to use the IP (172.17.0.3) instead.
# On a user-defined bridge network, Docker enables automatic DNS resolution between containers. So:
# 
# prometheus can reach node_exporter:9100
# 
# You don’t need to hardcode IPs like 172.17.0.3
# 
# This makes your prometheus.yml cleaner and more reproducible: